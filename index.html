<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Don't Order Wrong</title>
<meta name="description" content="Your personal restaurant journal. Rate dishes, log memories, and never order wrong again." />
<meta property="og:title" content="Don't Order Wrong" />
<meta property="og:description" content="Your personal restaurant journal. Rate dishes, log memories, and never order wrong again." />
<meta property="og:url" content="https://dontorderwrong.com" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Don't Order Wrong" />
<meta name="twitter:description" content="Your personal restaurant journal." />
<!-- PWA / home screen -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="Don't Order Wrong" />
<meta name="theme-color" content="#181410" />

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Jost:wght@300;400;500&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
  :root {
    --ink: #181410;
    --paper: #F7F2EB;
    --warm: #EDE5D8;
    --accent: #B85C38;
    --muted: #9B8F85;
    --gold: #C8963E;
    --green: #4A6741;
    --border: rgba(24,20,16,0.12);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Jost', sans-serif; background: var(--paper); color: var(--ink); min-height: 100vh; }
  .view { display: none; }
  .view.active { display: block; }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 1.1rem 1.5rem;
    border-bottom: 1px solid var(--border);
    background: var(--paper);
    position: sticky; top: 0; z-index: 50;
  }
  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.7rem; font-weight: 400; letter-spacing: 1.5px;
    display: flex; align-items: center; gap: 0.4rem;
  }
  .logo-plate { font-size: 1.3rem; }
  .logo em { font-style: normal; color: var(--accent); }
  .logo-dotcom {
    font-family: 'Jost', sans-serif; font-weight: 300;
    font-size: 0.72rem; color: var(--muted); letter-spacing: 1px;
    text-transform: lowercase; align-self: flex-end; margin-bottom: 3px;
  }
  .add-btn {
    background: var(--ink); color: var(--paper); border: none;
    width: 36px; height: 36px; border-radius: 50%; font-size: 1.3rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
  }
  .add-btn:hover { background: var(--accent); }
  .back-btn {
    background: none; border: none; font-family: 'Jost', sans-serif;
    font-size: 0.85rem; color: var(--muted); cursor: pointer;
    display: flex; align-items: center; gap: 0.4rem;
  }
  .back-btn:hover { color: var(--ink); }

  /* ‚îÄ‚îÄ LIST ‚îÄ‚îÄ */
  .journal-header { padding: 2rem 1.5rem 1rem; }
  .journal-header h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.2rem; font-weight: 400; font-style: italic; margin-bottom: 0.25rem;
  }
  .journal-header p { font-size: 0.82rem; color: var(--muted); }

  .filter-row {
    display: flex; gap: 0.4rem; padding: 0 1.5rem 1.25rem;
    overflow-x: auto; scrollbar-width: none;
  }
  .filter-row::-webkit-scrollbar { display: none; }
  .chip {
    padding: 0.3rem 0.85rem; border-radius: 2rem; border: 1px solid var(--border);
    font-size: 0.75rem; white-space: nowrap; cursor: pointer;
    background: transparent; font-family: 'Jost', sans-serif; color: var(--ink);
    transition: all 0.15s;
  }
  .chip.active, .chip:hover { background: var(--ink); color: var(--paper); border-color: var(--ink); }

  .entries { padding: 0 1.5rem 6rem; }
  .month-label {
    font-size: 0.7rem; font-weight: 500; letter-spacing: 2.5px;
    text-transform: uppercase; color: var(--muted); margin: 1.5rem 0 0.75rem;
  }

  .loading-state, .empty-state, .error-state {
    text-align: center; padding: 4rem 2rem; color: var(--muted);
  }
  .loading-spinner {
    width: 32px; height: 32px; border: 2px solid var(--warm);
    border-top-color: var(--ink); border-radius: 50%;
    animation: spin 0.8s linear infinite; margin: 0 auto 1rem;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .empty-state .emoji { font-size: 3rem; margin-bottom: 1rem; }
  .empty-state h3 { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; margin-bottom: 0.5rem; }
  .empty-state p { font-size: 0.85rem; line-height: 1.6; }

  .entry-card {
    background: white; border-radius: 0.875rem; padding: 1.1rem 1.2rem;
    margin-bottom: 0.75rem; border: 1px solid var(--border); cursor: pointer;
    transition: all 0.18s; display: flex; align-items: center; gap: 1rem;
    animation: fadeIn 0.3s ease both;
  }
  .entry-card:hover { border-color: var(--ink); box-shadow: 3px 3px 0 var(--ink); transform: translate(-1px,-1px); }

  /* Photo thumbnail on card */
  .entry-thumb {
    width: 52px; height: 52px; border-radius: 0.6rem; flex-shrink: 0;
    object-fit: cover; border: 1px solid var(--border);
  }
  .entry-thumb-placeholder {
    width: 52px; height: 52px; border-radius: 0.6rem; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center; font-size: 1.6rem;
  }

  .entry-info { flex: 1; min-width: 0; }
  .entry-name {
    font-family: 'Cormorant Garamond', serif; font-size: 1.15rem; font-weight: 600;
    margin-bottom: 0.15rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .entry-meta {
    font-size: 0.75rem; color: var(--muted);
    display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; margin-bottom: 0.35rem;
  }
  .entry-tags { display: flex; gap: 0.3rem; flex-wrap: wrap; }
  .tag-pill { font-size: 0.65rem; padding: 0.15rem 0.55rem; border-radius: 2rem; font-weight: 500; }
  .tag-italian    { background:#FDE8D8;color:#B85C38; }
  .tag-japanese   { background:#D8EBF5;color:#2A6080; }
  .tag-mexican    { background:#FDF3D8;color:#9B7020; }
  .tag-french     { background:#E8D8F5;color:#6040A0; }
  .tag-casual     { background:#E2EDD8;color:#4A6741; }
  .tag-finedining { background:#D8E0F5;color:#2A3E80; }
  .tag-brunch     { background:#F5D8E8;color:#A02060; }
  .tag-thai       { background:#D8F5E8;color:#206040; }
  .tag-other      { background:#EEE;color:#555; }

  .entry-score { flex-shrink: 0; text-align: center; }
  .score-num { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; font-weight: 600; line-height: 1; }
  .score-denom { font-size: 0.65rem; color: var(--muted); }
  .score-bar { width: 36px; height: 3px; background: var(--warm); border-radius: 2px; margin-top: 4px; overflow: hidden; }
  .score-fill { height: 100%; border-radius: 2px; background: var(--accent); }

  /* ‚îÄ‚îÄ SETUP BANNER ‚îÄ‚îÄ */
  .setup-banner {
    margin: 1rem 1.5rem; background: #FFF8E8; border: 1.5px solid var(--gold);
    border-radius: 0.75rem; padding: 1rem 1.1rem; font-size: 0.82rem; line-height: 1.6; color: #7A5A20;
  }
  .setup-banner strong { display: block; margin-bottom: 0.25rem; font-size: 0.85rem; }
  .setup-banner input {
    width: 100%; margin-top: 0.5rem; padding: 0.5rem 0.75rem;
    border: 1px solid var(--gold); border-radius: 0.5rem;
    font-family: 'Jost', sans-serif; font-size: 0.82rem; background: white; color: var(--ink); outline: none;
  }
  .save-url-btn {
    margin-top: 0.5rem; background: var(--gold); color: white; border: none;
    padding: 0.4rem 1rem; border-radius: 0.5rem; font-family: 'Jost', sans-serif;
    font-size: 0.8rem; cursor: pointer;
  }

  /* ‚îÄ‚îÄ DETAIL VIEW ‚îÄ‚îÄ */
  /* Photo hero */
  .detail-hero {
    width: 100%; height: 260px; position: relative; overflow: hidden;
    display: flex; align-items: center; justify-content: center;
  }
  .detail-hero-img {
    width: 100%; height: 100%; object-fit: cover;
  }
  .detail-hero-placeholder {
    width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center; font-size: 6rem;
  }
  .detail-hero-overlay {
    position: absolute; bottom: 0; left: 0; right: 0; height: 80px;
    background: linear-gradient(transparent, rgba(0,0,0,0.35));
  }

  .detail-body { padding: 1.5rem; }
  .detail-name {
    font-family: 'Cormorant Garamond', serif; font-size: 2rem; font-weight: 600;
    margin-bottom: 0.2rem; line-height: 1.2;
  }
  .detail-sub { font-size: 0.82rem; color: var(--muted); display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
  .detail-tags { display: flex; gap: 0.4rem; flex-wrap: wrap; margin-bottom: 1.5rem; }

  .section-title {
    font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase;
    font-weight: 500; color: var(--muted); margin-bottom: 0.75rem;
  }

  .overall-score-block {
    display: flex; align-items: center; gap: 1.5rem; background: var(--ink);
    color: var(--paper); padding: 1.25rem 1.5rem; border-radius: 1rem; margin-bottom: 1.5rem;
  }
  .big-score { font-family: 'Cormorant Garamond', serif; font-size: 3.5rem; font-weight: 600; line-height: 1; }
  .big-score span { font-size: 1rem; opacity: 0.5; }
  .score-label { font-size: 0.8rem; opacity: 0.6; margin-top: 0.2rem; }
  .score-breakdown-label { font-size: 0.85rem; opacity: 0.7; }

  .aspects { margin-bottom: 1.5rem; }
  .aspect-row { display: flex; align-items: center; gap: 0.75rem; padding: 0.6rem 0; border-bottom: 1px solid var(--border); }
  .aspect-row:last-child { border-bottom: none; }
  .aspect-name { font-size: 0.85rem; width: 115px; flex-shrink: 0; color: var(--muted); }
  .aspect-track { flex: 1; height: 6px; background: var(--warm); border-radius: 3px; overflow: hidden; }
  .aspect-fill { height: 100%; border-radius: 3px; }
  .fill-high { background: var(--green); }
  .fill-mid  { background: var(--gold); }
  .fill-low  { background: var(--accent); }
  .aspect-val { font-size: 0.85rem; font-weight: 500; width: 28px; text-align: right; flex-shrink: 0; }

  /* Photo gallery in detail */
  .photo-gallery { display: flex; gap: 0.6rem; overflow-x: auto; padding-bottom: 0.5rem; margin-bottom: 1.5rem; scrollbar-width: none; }
  .photo-gallery::-webkit-scrollbar { display: none; }
  .gallery-img {
    height: 110px; width: 110px; object-fit: cover; border-radius: 0.6rem;
    border: 1px solid var(--border); flex-shrink: 0; cursor: pointer; transition: transform 0.15s;
  }
  .gallery-img:hover { transform: scale(1.03); }
  .no-photos { color: var(--muted); font-size: 0.82rem; font-style: italic; margin-bottom: 1.5rem; }

  /* Map section */
  .map-block {
    border: 1.5px solid var(--border); border-radius: 0.875rem; overflow: hidden;
    margin-bottom: 1.5rem; cursor: pointer; transition: all 0.18s;
    text-decoration: none; display: block;
  }
  .map-block:hover { border-color: var(--ink); box-shadow: 3px 3px 0 var(--ink); transform: translate(-1px,-1px); }
  .map-preview {
    height: 160px; background: #E8F0E8; position: relative;
    display: flex; align-items: center; justify-content: center;
    overflow: hidden;
  }
  .map-preview iframe {
    width: 100%; height: 100%; border: none; pointer-events: none;
  }
  .map-footer {
    padding: 0.75rem 1rem; background: white;
    display: flex; align-items: center; justify-content: space-between;
    font-size: 0.82rem;
  }
  .map-footer strong { font-weight: 500; }
  .map-cta { font-size: 0.75rem; color: var(--accent); font-weight: 500; }

  .companions-block { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1.5rem; }
  .companion-pill {
    display: flex; align-items: center; gap: 0.4rem; background: var(--warm);
    border-radius: 2rem; padding: 0.3rem 0.75rem; font-size: 0.8rem;
  }
  .companion-avatar {
    width: 22px; height: 22px; border-radius: 50%; background: var(--muted);
    display: flex; align-items: center; justify-content: center;
    color: white; font-size: 0.6rem; font-weight: 600;
  }

  .notes-block {
    background: var(--warm); border-radius: 0.75rem; padding: 1rem 1.1rem;
    font-size: 0.88rem; line-height: 1.75; color: #444; margin-bottom: 1.5rem;
    font-style: italic; border-left: 3px solid var(--gold);
  }

  .share-row { display: flex; gap: 0.75rem; padding-bottom: 4rem; }
  .share-btn {
    flex: 1; padding: 0.85rem; border-radius: 0.75rem; border: 1.5px dashed var(--border);
    background: transparent; font-family: 'Jost', sans-serif; font-size: 0.82rem; color: var(--muted);
    cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.4rem;
    transition: all 0.2s; position: relative;
  }
  .share-btn:hover { border-color: var(--ink); color: var(--ink); }
  .coming-badge {
    position: absolute; top: -8px; right: -4px; background: var(--gold); color: white;
    font-size: 0.55rem; padding: 0.1rem 0.4rem; border-radius: 2rem; letter-spacing: 0.5px; font-weight: 500;
  }

  /* ‚îÄ‚îÄ ADD FORM ‚îÄ‚îÄ */
  .form-body { padding: 1.5rem 1.5rem 5rem; }
  .form-body h2 { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; font-style: italic; margin-bottom: 1.5rem; }
  .field { margin-bottom: 1.1rem; }
  .field label {
    display: block; font-size: 0.72rem; letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--muted); font-weight: 500; margin-bottom: 0.4rem;
  }
  .field input, .field select, .field textarea {
    width: 100%; padding: 0.65rem 0.9rem; border: 1.5px solid var(--border);
    border-radius: 0.6rem; font-family: 'Jost', sans-serif; font-size: 0.9rem;
    background: white; color: var(--ink); outline: none; transition: border-color 0.2s;
  }
  .field input:focus, .field select:focus, .field textarea:focus { border-color: var(--ink); }
  .field textarea { resize: vertical; min-height: 80px; }
  .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }

  /* Photo upload */
  .photo-upload-area {
    border: 2px dashed var(--border); border-radius: 0.75rem; padding: 1.5rem;
    text-align: center; cursor: pointer; transition: all 0.2s; background: white;
  }
  .photo-upload-area:hover { border-color: var(--ink); background: var(--warm); }
  .photo-upload-area input { display: none; }
  .upload-icon { font-size: 2rem; margin-bottom: 0.5rem; }
  .upload-label { font-size: 0.82rem; color: var(--muted); }
  .upload-label strong { color: var(--ink); }
  .photo-previews { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.75rem; }
  .preview-wrap { position: relative; }
  .preview-img { width: 70px; height: 70px; object-fit: cover; border-radius: 0.5rem; border: 1px solid var(--border); }
  .remove-photo {
    position: absolute; top: -6px; right: -6px; width: 18px; height: 18px;
    background: var(--accent); color: white; border: none; border-radius: 50%;
    font-size: 0.65rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
  }

  .slider-group { margin-bottom: 1.5rem; }
  .slider-row { display: flex; align-items: center; gap: 0.75rem; padding: 0.55rem 0; border-bottom: 1px solid var(--border); }
  .slider-row:last-child { border-bottom: none; }
  .slider-name { width: 115px; font-size: 0.82rem; color: var(--muted); flex-shrink: 0; }
  .slider-row input[type=range] { flex: 1; -webkit-appearance: none; height: 4px; background: var(--warm); border-radius: 2px; outline: none; border: none; padding: 0; }
  .slider-row input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: var(--ink); cursor: pointer; }
  .slider-val { width: 24px; text-align: right; font-size: 0.85rem; font-weight: 500; }

  .tags-picker { display: flex; gap: 0.4rem; flex-wrap: wrap; }
  .tag-pick {
    padding: 0.3rem 0.85rem; border-radius: 2rem; border: 1px solid var(--border);
    font-size: 0.75rem; cursor: pointer; background: transparent;
    font-family: 'Jost', sans-serif; color: var(--ink); transition: all 0.15s;
  }
  .tag-pick.selected { background: var(--ink); color: var(--paper); border-color: var(--ink); }

  .submit-btn {
    width: 100%; padding: 1rem; background: var(--ink); color: var(--paper); border: none;
    border-radius: 0.75rem; font-family: 'Jost', sans-serif; font-size: 0.95rem; font-weight: 500;
    cursor: pointer; margin-top: 1.5rem; transition: background 0.2s;
    display: flex; align-items: center; justify-content: center; gap: 0.5rem;
  }
  .submit-btn:hover { background: var(--accent); }
  .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; }

  /* ‚îÄ‚îÄ PROFILE VIEW ‚îÄ‚îÄ */
  .profile-hero {
    background: var(--ink); padding: 3rem 1.5rem 2rem;
    text-align: center; position: relative;
  }
  .profile-avatar-wrap {
    width: 80px; height: 80px; border-radius: 50%;
    background: var(--accent); margin: 0 auto 1rem;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Cormorant Garamond', serif; font-size: 2rem; font-weight: 600; color: white;
    border: 3px solid rgba(255,255,255,0.15);
  }
  .profile-name-display {
    font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; font-weight: 600;
    color: var(--paper); margin-bottom: 0.25rem;
  }
  .profile-email-display { font-size: 0.82rem; color: rgba(255,255,255,0.5); }

  .profile-stats {
    display: grid; grid-template-columns: repeat(3, 1fr);
    border-bottom: 1px solid var(--border); background: white;
  }
  .stat-block { padding: 1.25rem 0.5rem; text-align: center; border-right: 1px solid var(--border); }
  .stat-block:last-child { border-right: none; }
  .stat-num { font-family: 'Cormorant Garamond', serif; font-size: 1.8rem; font-weight: 600; line-height: 1; }
  .stat-label { font-size: 0.7rem; color: var(--muted); margin-top: 0.2rem; letter-spacing: 0.5px; }

  .profile-body { padding: 1.5rem; }
  .profile-section-title {
    font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase;
    font-weight: 500; color: var(--muted); margin-bottom: 0.75rem; margin-top: 1.5rem;
  }
  .profile-field {
    margin-bottom: 0.75rem;
  }
  .profile-field label {
    display: block; font-size: 0.72rem; letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--muted); font-weight: 500; margin-bottom: 0.4rem;
  }
  .profile-field input {
    width: 100%; padding: 0.65rem 0.9rem; border: 1.5px solid var(--border);
    border-radius: 0.6rem; font-family: 'Jost', sans-serif; font-size: 0.9rem;
    background: white; color: var(--ink); outline: none; transition: border-color 0.2s;
  }
  .profile-field input:focus { border-color: var(--ink); }
  .profile-save-btn {
    width: 100%; padding: 0.9rem; background: var(--ink); color: var(--paper); border: none;
    border-radius: 0.75rem; font-family: 'Jost', sans-serif; font-size: 0.9rem; font-weight: 500;
    cursor: pointer; margin-top: 0.5rem; transition: background 0.2s;
  }
  .profile-save-btn:hover { background: var(--accent); }

  .profile-menu { margin-top: 0.5rem; padding-bottom: 5rem; }
  .menu-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 1rem 0; border-bottom: 1px solid var(--border); cursor: pointer;
    font-size: 0.9rem;
  }
  .menu-row:hover { color: var(--accent); }
  .menu-row span { color: var(--muted); font-size: 0.8rem; }

  /* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
  .bottom-nav {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--paper); border-top: 1px solid var(--border);
    display: flex; z-index: 60; padding-bottom: env(safe-area-inset-bottom);
  }
  .nav-tab {
    flex: 1; padding: 0.75rem 0.5rem; display: flex; flex-direction: column;
    align-items: center; gap: 0.25rem; cursor: pointer; border: none;
    background: transparent; font-family: 'Jost', sans-serif; color: var(--muted);
    font-size: 0.65rem; font-weight: 500; letter-spacing: 0.5px; transition: color 0.15s;
  }
  .nav-tab .tab-icon { font-size: 1.2rem; }
  .nav-tab.active { color: var(--accent); }
  .nav-tab:hover { color: var(--ink); }

  /* Onboarding / welcome screen */
  .onboard-wrap {
    min-height: 100vh; display: flex; flex-direction: column;
    align-items: center; justify-content: center; padding: 2rem 1.5rem;
    text-align: center;
  }
  .onboard-logo { font-size: 3.5rem; margin-bottom: 1rem; }
  .onboard-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 3.5rem; font-weight: 400; letter-spacing: 2px;
    margin-bottom: 0.5rem; line-height: 1.1;
  }
  .onboard-title em { font-style: normal; color: var(--accent); }
  .onboard-sub { font-size: 0.9rem; color: var(--muted); margin-bottom: 2.5rem; line-height: 1.6; }
  .onboard-form { width: 100%; max-width: 360px; }
  .onboard-field { margin-bottom: 0.9rem; text-align: left; }
  .onboard-field label {
    display: block; font-size: 0.72rem; letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--muted); font-weight: 500; margin-bottom: 0.4rem;
  }
  .onboard-field input {
    width: 100%; padding: 0.75rem 1rem; border: 1.5px solid var(--border);
    border-radius: 0.75rem; font-family: 'Jost', sans-serif; font-size: 1rem;
    background: white; color: var(--ink); outline: none; transition: border-color 0.2s;
  }
  .onboard-field input:focus { border-color: var(--ink); }
  .onboard-btn {
    width: 100%; padding: 1rem; background: var(--ink); color: var(--paper); border: none;
    border-radius: 0.75rem; font-family: 'Jost', sans-serif; font-size: 1rem; font-weight: 500;
    cursor: pointer; margin-top: 0.75rem; transition: background 0.2s;
  }
  .onboard-btn:hover { background: var(--accent); }
  .onboard-note { font-size: 0.75rem; color: var(--muted); margin-top: 1rem; line-height: 1.5; }

  /* Lightbox */
  .lightbox {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92);
    z-index: 200; align-items: center; justify-content: center;
  }
  .lightbox.open { display: flex; }
  .lightbox img { max-width: 92vw; max-height: 88vh; object-fit: contain; border-radius: 0.5rem; }
  .lightbox-close {
    position: absolute; top: 1.25rem; right: 1.25rem; background: none; border: none;
    color: white; font-size: 1.8rem; cursor: pointer; opacity: 0.7;
  }
  .lightbox-close:hover { opacity: 1; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ONBOARDING VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="onboardView" class="view">
  <div class="onboard-wrap">
    <div class="onboard-logo">üçΩÔ∏è</div>
    <h1 class="onboard-title">Don't Order <em>Wrong</em> <span style="font-size:1rem;font-weight:300;color:var(--muted);font-style:normal;letter-spacing:1px">dot com</span></h1>
    <p class="onboard-sub">Your personal dining journal.<br>Rate restaurants, log memories, share your taste.</p>
    <div class="onboard-form">
      <div class="onboard-field">
        <label>Your First Name *</label>
        <input type="text" id="ob_name" placeholder="e.g. Mike" autocomplete="given-name" />
      </div>
      <div class="onboard-field">
        <label>Email Address *</label>
        <input type="email" id="ob_email" placeholder="you@email.com" autocomplete="email" />
      </div>
      <button class="onboard-btn" onclick="completeOnboarding()">Get Started ‚Üí</button>
      <p class="onboard-note">Your info is saved locally on your device. No password needed ‚Äî just your name and email to personalise your journal.</p>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LIST VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="listView" class="view">
  <header>
    <div class="logo"><span class="logo-plate">üçΩÔ∏è</span> Don't Order <em>Wrong</em> <span class="logo-dotcom">dot com</span></div>
    <button class="add-btn" onclick="showView('addView')" title="Add entry">+</button>
  </header>

  <div class="journal-header">
    <h1 id="journalTitle">My Dining Journal</h1>
    <p id="entryCount">Loading entries‚Ä¶</p>
  </div>

  <div class="filter-row">
    <button class="chip active" onclick="filterEntries('All', this)">All</button>
    <button class="chip" onclick="filterEntries('Italian', this)">Italian</button>
    <button class="chip" onclick="filterEntries('Japanese', this)">Japanese</button>
    <button class="chip" onclick="filterEntries('Mexican', this)">Mexican</button>
    <button class="chip" onclick="filterEntries('French', this)">French</button>
    <button class="chip" onclick="filterEntries('Thai', this)">Thai</button>
    <button class="chip" onclick="filterEntries('Fine Dining', this)">Fine Dining</button>
    <button class="chip" onclick="filterEntries('Casual', this)">Casual</button>
  </div>

  <div class="entries" id="entriesList">
    <div class="loading-state"><div class="loading-spinner"></div><p>Loading your journal‚Ä¶</p></div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <button class="nav-tab active" onclick="switchTab('listView', this)">
      <span class="tab-icon">üìñ</span>Journal
    </button>
    <button class="nav-tab" onclick="showView('addView')">
      <span class="tab-icon">Ôºã</span>Add
    </button>
    <button class="nav-tab" onclick="switchTab('profileView', this)">
      <span class="tab-icon">üë§</span>Profile
    </button>
  </nav>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DETAIL VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="detailView" class="view">
  <header>
    <button class="back-btn" onclick="showView('listView')">‚Üê Back</button>
    <div style="font-size:0.75rem;color:var(--muted)" id="detailDate"></div>
  </header>

  <div class="detail-hero" id="detailHero"></div>

  <div class="detail-body">
    <div class="detail-name" id="detailName"></div>
    <div class="detail-sub" id="detailSub"></div>
    <div class="detail-tags" id="detailTags"></div>

    <div class="section-title">Overall Score</div>
    <div class="overall-score-block">
      <div>
        <div class="big-score" id="detailScore">‚Äî <span>/10</span></div>
        <div class="score-label">Overall Rating</div>
      </div>
      <div style="flex:1">
        <div class="score-breakdown-label" id="detailVerdict"></div>
      </div>
    </div>

    <div class="section-title">Breakdown</div>
    <div class="aspects" id="detailAspects"></div>

    <div class="section-title">Photos</div>
    <div id="detailPhotos"></div>

    <div class="section-title">Location</div>
    <div id="detailMap"></div>

    <div class="section-title">Dined With</div>
    <div class="companions-block" id="detailCompanions"></div>

    <div class="section-title">Notes</div>
    <div class="notes-block" id="detailNotes"></div>

    <div class="section-title">Share</div>
    <div class="share-row">
      <button class="share-btn"><span class="coming-badge">Soon</span>üì± Share to Social</button>
      <button class="share-btn"><span class="coming-badge">Soon</span>üîó Send to Friend</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADD VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="addView" class="view">
  <header>
    <button class="back-btn" onclick="showView('listView')">‚Üê Cancel</button>
    <div style="font-size:0.82rem;font-weight:500">New Entry</div>
  </header>
  <div class="form-body">
    <h2>Where did you eat?</h2>

    <div class="field">
      <label>Restaurant Name *</label>
      <input type="text" id="f_name" placeholder="e.g. Osteria Vecchia" />
    </div>
    <div class="row2">
      <div class="field">
        <label>Date Visited *</label>
        <input type="date" id="f_date" />
      </div>
      <div class="field">
        <label>Cuisine *</label>
        <select id="f_cuisine">
          <option>Italian</option>
          <option>Japanese</option>
          <option>Mexican</option>
          <option>French</option>
          <option>Thai</option>
          <option>Other</option>
        </select>
      </div>
    </div>

    <div class="field">
      <label>City / Neighbourhood</label>
      <input type="text" id="f_location" placeholder="e.g. Little Italy, Toronto" />
    </div>

    <div class="field">
      <label>Who did you go with?</label>
      <input type="text" id="f_companions" placeholder="e.g. Sofia, Marco (or Solo)" />
    </div>

    <div class="field">
      <label>Tags</label>
      <div class="tags-picker" id="tagsPicker">
        <button class="tag-pick" onclick="toggleTag(this)">Fine Dining</button>
        <button class="tag-pick" onclick="toggleTag(this)">Casual</button>
        <button class="tag-pick" onclick="toggleTag(this)">Brunch</button>
        <button class="tag-pick" onclick="toggleTag(this)">Special Occasion</button>
        <button class="tag-pick" onclick="toggleTag(this)">Business</button>
        <button class="tag-pick" onclick="toggleTag(this)">Date Night</button>
      </div>
    </div>

    <!-- Photo upload -->
    <div class="field">
      <label>Photos</label>
      <div class="photo-upload-area" onclick="document.getElementById('photoInput').click()">
        <input type="file" id="photoInput" accept="image/*" multiple onchange="handlePhotoUpload(event)" />
        <div class="upload-icon">üì∑</div>
        <div class="upload-label"><strong>Tap to add photos</strong><br>JPG, PNG ‚Äî up to 5 photos</div>
      </div>
      <div class="photo-previews" id="photoPreviews"></div>
    </div>

    <div class="field" style="margin-top:1.5rem">
      <label>Rate Each Aspect (out of 10)</label>
    </div>
    <div class="slider-group">
      <div class="slider-row">
        <div class="slider-name">üçΩÔ∏è Cuisine</div>
        <input type="range" id="s_cuisine" min="1" max="10" value="7" oninput="updateSlider(this)">
        <div class="slider-val">7</div>
      </div>
      <div class="slider-row">
        <div class="slider-name">üåø Atmosphere</div>
        <input type="range" id="s_atmosphere" min="1" max="10" value="7" oninput="updateSlider(this)">
        <div class="slider-val">7</div>
      </div>
      <div class="slider-row">
        <div class="slider-name">ü§ù Service</div>
        <input type="range" id="s_service" min="1" max="10" value="7" oninput="updateSlider(this)">
        <div class="slider-val">7</div>
      </div>
      <div class="slider-row">
        <div class="slider-name">üí∞ Value</div>
        <input type="range" id="s_value" min="1" max="10" value="7" oninput="updateSlider(this)">
        <div class="slider-val">7</div>
      </div>
      <div class="slider-row">
        <div class="slider-name">üîá Noise Level</div>
        <input type="range" id="s_noise" min="1" max="10" value="7" oninput="updateSlider(this)">
        <div class="slider-val">7</div>
      </div>
    </div>

    <div class="field">
      <label>Notes & Highlights</label>
      <textarea id="f_notes" placeholder="What stood out? Any dishes to remember? Would you go back?"></textarea>
    </div>

    <button class="submit-btn" id="submitBtn" onclick="saveEntry()">Save to Journal ‚úì</button>
    <div id="saveStatus" style="text-align:center;font-size:0.8rem;color:var(--muted);margin-top:0.75rem;min-height:1.2em"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PROFILE VIEW ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="profileView" class="view">
  <header>
    <div class="logo"><span class="logo-plate">üçΩÔ∏è</span> Don't Order <em>Wrong</em> <span class="logo-dotcom">dot com</span></div>
    <div style="width:36px"></div>
  </header>

  <div class="profile-hero">
    <div class="profile-avatar-wrap" id="profileAvatar">?</div>
    <div class="profile-name-display" id="profileNameDisplay">Your Name</div>
    <div class="profile-email-display" id="profileEmailDisplay">your@email.com</div>
  </div>

  <div class="profile-stats">
    <div class="stat-block">
      <div class="stat-num" id="statVisits">0</div>
      <div class="stat-label">Visits</div>
    </div>
    <div class="stat-block">
      <div class="stat-num" id="statAvg">‚Äî</div>
      <div class="stat-label">Avg Score</div>
    </div>
    <div class="stat-block">
      <div class="stat-num" id="statTop">‚Äî</div>
      <div class="stat-label">Top Cuisine</div>
    </div>
  </div>

  <div class="profile-body">
    <div class="profile-section-title" style="margin-top:0">Edit Profile</div>
    <div class="profile-field">
      <label>First Name</label>
      <input type="text" id="p_name" placeholder="Your name" />
    </div>
    <div class="profile-field">
      <label>Email Address</label>
      <input type="email" id="p_email" placeholder="you@email.com" />
    </div>
    <button class="profile-save-btn" onclick="saveProfile()">Save Changes ‚úì</button>

    <div class="profile-section-title">App Settings</div>
    <div class="profile-menu">
      <div class="menu-row" onclick="resetApiUrl()">
        ‚öôÔ∏è Change Database URL <span>SheetDB ‚Üí</span>
      </div>
      <div class="menu-row" onclick="if(confirm('Clear all local data?')) { localStorage.clear(); location.reload(); }">
        üóëÔ∏è Clear Local Data <span>Photos & settings</span>
      </div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <button class="nav-tab" onclick="switchTab('listView', this)">
      <span class="tab-icon">üìñ</span>Journal
    </button>
    <button class="nav-tab" onclick="showView('addView')">
      <span class="tab-icon">Ôºã</span>Add
    </button>
    <button class="nav-tab active" onclick="switchTab('profileView', this)">
      <span class="tab-icon">üë§</span>Profile
    </button>
  </nav>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>
  <img id="lightboxImg" src="" alt="" />
</div>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const API_URL = 'https://sheetdb.io/api/v1/2xz775fy5o3we';

const CUISINE_EMOJIS = { Italian:'üçù', Japanese:'üç£', Mexican:'üåÆ', French:'ü•ê', Thai:'üçú', Other:'üç¥' };
const CUISINE_BG     = {
  Italian:'linear-gradient(135deg,#C4522A,#D4A853)',
  Japanese:'linear-gradient(135deg,#1C4A6B,#7BAFC8)',
  Mexican:'linear-gradient(135deg,#9B7020,#E8B84B)',
  French:'linear-gradient(135deg,#6040A0,#C0A0E0)',
  Thai:'linear-gradient(135deg,#206040,#80C0A0)',
  Other:'linear-gradient(135deg,#555,#999)'
};
const CUISINE_EMOJI_BG = { Italian:'#FDE8D8', Japanese:'#D8EBF5', Mexican:'#FDF3D8', French:'#E8D8F5', Thai:'#D8F5E8', Other:'#EEE' };
const TAG_CLASS = {
  'Italian':'tag-italian','Japanese':'tag-japanese','Mexican':'tag-mexican','French':'tag-french',
  'Thai':'tag-thai','Casual':'tag-casual','Fine Dining':'tag-finedining','Brunch':'tag-brunch',
  'Other':'tag-other','Special Occasion':'tag-finedining','Business':'tag-other','Date Night':'tag-brunch'
};

let allEntries = [];
let pendingPhotos = []; // base64 strings for new entry

// ‚îÄ‚îÄ‚îÄ PROFILE / ONBOARDING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getProfile() {
  return {
    name:  localStorage.getItem('profile_name')  || '',
    email: localStorage.getItem('profile_email') || '',
  };
}

function completeOnboarding() {
  const name  = document.getElementById('ob_name').value.trim();
  const email = document.getElementById('ob_email').value.trim();
  if (!name)  { alert('Please enter your first name.'); return; }
  if (!email || !email.includes('@')) { alert('Please enter a valid email.'); return; }
  localStorage.setItem('profile_name',  name);
  localStorage.setItem('profile_email', email);
  showMainApp();
}

function showMainApp() {
  updateJournalTitle();
  showView('listView');
}

function updateJournalTitle() {
  const { name } = getProfile();
  const titleEl = document.getElementById('journalTitle');
  if (titleEl) titleEl.textContent = name ? `${name}'s Dining Journal` : "Don't Order Wrong";
}

function saveProfile() {
  const name  = document.getElementById('p_name').value.trim();
  const email = document.getElementById('p_email').value.trim();
  if (!name)  { alert('Please enter your name.'); return; }
  if (!email || !email.includes('@')) { alert('Please enter a valid email.'); return; }
  localStorage.setItem('profile_name',  name);
  localStorage.setItem('profile_email', email);
  refreshProfileView();
  updateJournalTitle();
  alert('‚úì Profile saved!');
}

function refreshProfileView() {
  const { name, email } = getProfile();
  document.getElementById('profileAvatar').textContent       = name ? name[0].toUpperCase() : '?';
  document.getElementById('profileNameDisplay').textContent  = name  || 'Your Name';
  document.getElementById('profileEmailDisplay').textContent = email || 'your@email.com';
  document.getElementById('p_name').value  = name;
  document.getElementById('p_email').value = email;

  // Stats from loaded entries
  const visits = allEntries.length;
  document.getElementById('statVisits').textContent = visits;
  if (visits > 0) {
    const scores = allEntries.map(e => parseFloat(calcOverall(e))).filter(v => !isNaN(v));
    const avg = scores.length ? (scores.reduce((a,b) => a+b,0)/scores.length).toFixed(1) : '‚Äî';
    document.getElementById('statAvg').textContent = avg;
    // Top cuisine
    const cuisineCount = {};
    allEntries.forEach(e => { if (e.cuisine) cuisineCount[e.cuisine] = (cuisineCount[e.cuisine]||0)+1; });
    const top = Object.entries(cuisineCount).sort((a,b) => b[1]-a[1])[0];
    document.getElementById('statTop').textContent = top ? top[0].slice(0,3) : '‚Äî';
  }
}

function resetApiUrl() {
  const url = prompt('Enter new SheetDB URL:', API_URL);
  // Since URL is hardcoded, just inform user
  alert('The database URL is set in the app code. Ask your developer to update it!');
}

function switchTab(viewId, btn) {
  // Update all bottom nav tabs
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.bottom-nav .nav-tab').forEach(t => {
    if (t.textContent.includes(btn.textContent.trim().split('\n').pop().trim())) t.classList.add('active');
  });
  btn.classList.add('active');
  if (viewId === 'profileView') {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById('profileView').classList.add('active');
    window.scrollTo(0,0);
    refreshProfileView();
  } else {
    showView(viewId);
  }
}

// ‚îÄ‚îÄ‚îÄ VIEWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
  if (id === 'listView') { updateJournalTitle(); loadEntries(); }
  if (id === 'addView')  resetForm();
}

function resetForm() {
  document.getElementById('f_date').value = new Date().toISOString().split('T')[0];
  document.getElementById('saveStatus').textContent = '';
  const btn = document.getElementById('submitBtn');
  btn.disabled = false; btn.textContent = 'Save to Journal ‚úì';
  ['s_cuisine','s_atmosphere','s_service','s_value','s_noise'].forEach(id => {
    const el = document.getElementById(id); el.value = 7; el.nextElementSibling.textContent = 7;
  });
  document.querySelectorAll('.tag-pick').forEach(t => t.classList.remove('selected'));
  ['f_name','f_companions','f_notes','f_location'].forEach(id => document.getElementById(id).value = '');
  pendingPhotos = [];
  document.getElementById('photoPreviews').innerHTML = '';
}

// ‚îÄ‚îÄ‚îÄ LOAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadEntries() {
  const list = document.getElementById('entriesList');
  list.innerHTML = `<div class="loading-state"><div class="loading-spinner"></div><p>Loading your journal‚Ä¶</p></div>`;
  try {
    const res = await fetch(`${API_URL}?limit=100`);
    if (!res.ok) throw new Error();
    allEntries = (await res.json()).reverse();
    renderEntries(allEntries);
  } catch {
    list.innerHTML = `<div class="error-state"><p>‚ö†Ô∏è Couldn't load entries. Check your connection.</p></div>`;
    document.getElementById('entryCount').textContent = 'Connection error';
  }
}

function renderEntries(entries) {
  const list = document.getElementById('entriesList');
  document.getElementById('entryCount').textContent =
    entries.length === 0 ? 'No entries yet' : `${entries.length} restaurant${entries.length !== 1 ? 's' : ''} visited`;

  if (entries.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="emoji">üçΩÔ∏è</div><h3>Your journal is empty</h3><p>Tap + to log your first restaurant visit!</p></div>`;
    return;
  }

  const groups = {};
  entries.forEach(e => {
    const d = new Date(e.date);
    const key = isNaN(d) ? 'Unknown Date' : d.toLocaleString('default', { month:'long', year:'numeric' });
    if (!groups[key]) groups[key] = [];
    groups[key].push(e);
  });

  let html = '';
  Object.entries(groups).forEach(([month, items]) => {
    html += `<div class="month-label">${month}</div>`;
    items.forEach((e, i) => {
      const score = calcOverall(e);
      const cuisine = e.cuisine || 'Other';
      const emoji = CUISINE_EMOJIS[cuisine] || 'üç¥';
      const bg = CUISINE_EMOJI_BG[cuisine] || '#EEE';
      const tags = (e.tags || '').split(',').filter(Boolean);
      const tagHtml = tags.map(t => `<span class="tag-pill ${TAG_CLASS[t.trim()]||'tag-other'}">${t.trim()}</span>`).join('');
      const dateStr = new Date(e.date).toLocaleDateString('en-US', { month:'short', day:'numeric' });
      const companions = e.companions && e.companions !== 'Solo' ? `üë• ${e.companions}` : '';

      // Show photo thumbnail if available
      const photos = getPhotos(e);
      const thumbHtml = photos.length > 0
        ? `<img class="entry-thumb" src="${photos[0]}" alt="photo" />`
        : `<div class="entry-thumb-placeholder" style="background:${bg}">${emoji}</div>`;

      html += `<div class="entry-card" style="animation-delay:${i*0.05}s" onclick="showEntryDetail(${allEntries.indexOf(e)})">
        ${thumbHtml}
        <div class="entry-info">
          <div class="entry-name">${e.name}</div>
          <div class="entry-meta">
            <span>üìÖ ${dateStr}</span>
            ${companions ? `<span>${companions}</span>` : ''}
          </div>
          <div class="entry-tags">${tagHtml}</div>
        </div>
        <div class="entry-score">
          <div class="score-num">${score}</div>
          <div class="score-denom">/10</div>
          <div class="score-bar"><div class="score-fill" style="width:${score === '‚Äî' ? 0 : score*10}%"></div></div>
        </div>
      </div>`;
    });
  });
  list.innerHTML = html;
}

// ‚îÄ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterEntries(filter, btn) {
  document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  if (filter === 'All') { renderEntries(allEntries); return; }
  renderEntries(allEntries.filter(e => e.cuisine === filter || (e.tags || '').includes(filter)));
}

// ‚îÄ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showEntryDetail(idx) {
  const e = allEntries[idx];
  const cuisine = e.cuisine || 'Other';
  const photos = getPhotos(e);

  document.getElementById('detailDate').textContent =
    new Date(e.date).toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

  // Hero ‚Äî use first photo if available, else gradient
  const hero = document.getElementById('detailHero');
  if (photos.length > 0) {
    hero.innerHTML = `<img class="detail-hero-img" src="${photos[0]}" alt="${e.name}" /><div class="detail-hero-overlay"></div>`;
  } else {
    hero.innerHTML = `<div class="detail-hero-placeholder" style="background:${CUISINE_BG[cuisine]||CUISINE_BG.Other}">${CUISINE_EMOJIS[cuisine]||'üç¥'}</div>`;
  }

  document.getElementById('detailName').textContent = e.name;
  document.getElementById('detailSub').innerHTML =
    `<span>${cuisine}</span>${e.location ? `<span>üìç ${e.location}</span>` : ''}`;

  const tags = (e.tags || '').split(',').filter(Boolean);
  document.getElementById('detailTags').innerHTML =
    tags.map(t => `<span class="tag-pill ${TAG_CLASS[t.trim()]||'tag-other'}">${t.trim()}</span>`).join('');

  const score = calcOverall(e);
  document.getElementById('detailScore').innerHTML = `${score} <span>/10</span>`;
  document.getElementById('detailVerdict').textContent = verdict(score);

  document.getElementById('detailAspects').innerHTML = [
    { name:'üçΩÔ∏è Cuisine',    key:'score_cuisine'    },
    { name:'üåø Atmosphere', key:'score_atmosphere' },
    { name:'ü§ù Service',    key:'score_service'    },
    { name:'üí∞ Value',      key:'score_value'      },
    { name:'üîá Noise Level',key:'score_noise'      },
  ].map(a => {
    const val = parseFloat(e[a.key]) || 0;
    return `<div class="aspect-row">
      <div class="aspect-name">${a.name}</div>
      <div class="aspect-track"><div class="aspect-fill ${getColor(val)}" style="width:${val*10}%"></div></div>
      <div class="aspect-val">${val}</div>
    </div>`;
  }).join('');

  // Photos gallery
  const photosEl = document.getElementById('detailPhotos');
  if (photos.length > 0) {
    photosEl.innerHTML = `<div class="photo-gallery">
      ${photos.map((src, i) => `<img class="gallery-img" src="${src}" alt="photo ${i+1}" onclick="openLightbox('${src}')" />`).join('')}
    </div>`;
  } else {
    photosEl.innerHTML = `<p class="no-photos">No photos added for this visit.</p>`;
  }

  // Map
  const mapEl = document.getElementById('detailMap');
  const mapQuery = encodeURIComponent(`${e.name}${e.location ? ' ' + e.location : ''}`);
  const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${mapQuery}`;
  const embedUrl = `https://maps.google.com/maps?q=${mapQuery}&output=embed&z=15`;
  mapEl.innerHTML = `
    <a class="map-block" href="${mapsUrl}" target="_blank" rel="noopener">
      <div class="map-preview">
        <iframe src="${embedUrl}" loading="lazy" title="Map of ${e.name}"></iframe>
      </div>
      <div class="map-footer">
        <div><strong>üìç ${e.name}</strong>${e.location ? `<span style="color:var(--muted);margin-left:0.5rem">${e.location}</span>` : ''}</div>
        <div class="map-cta">Open in Maps ‚Üí</div>
      </div>
    </a>`;

  // Companions
  const companions = (e.companions || '').split(',').filter(Boolean);
  const compEl = document.getElementById('detailCompanions');
  if (!e.companions || e.companions === 'Solo' || companions.length === 0) {
    compEl.innerHTML = `<div class="companion-pill">üö∂ Solo visit</div>`;
  } else {
    compEl.innerHTML = companions.map(c => `
      <div class="companion-pill">
        <div class="companion-avatar">${c.trim()[0].toUpperCase()}</div>${c.trim()}
      </div>`).join('');
  }

  document.getElementById('detailNotes').textContent = e.notes ? `"${e.notes}"` : 'No notes added.';
  showView('detailView');
}

// ‚îÄ‚îÄ‚îÄ PHOTOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getPhotos(entry) {
  // Photos stored in localStorage keyed by entry name + date
  const key = `photos_${entry.name}_${entry.date}`;
  try { return JSON.parse(localStorage.getItem(key)) || []; } catch { return []; }
}

function savePhotos(entry, photos) {
  const key = `photos_${entry.name}_${entry.date}`;
  localStorage.setItem(key, JSON.stringify(photos));
}

function handlePhotoUpload(event) {
  const files = [...event.target.files].slice(0, 5 - pendingPhotos.length);
  files.forEach(file => {
    const reader = new FileReader();
    reader.onload = (e) => {
      // Compress image before storing
      compressImage(e.target.result, 800, 0.7, (compressed) => {
        pendingPhotos.push(compressed);
        renderPhotoPreviews();
      });
    };
    reader.readAsDataURL(file);
  });
}

function compressImage(dataUrl, maxWidth, quality, callback) {
  const img = new Image();
  img.onload = () => {
    const canvas = document.createElement('canvas');
    const scale = Math.min(1, maxWidth / img.width);
    canvas.width = img.width * scale;
    canvas.height = img.height * scale;
    canvas.getContext('2d').drawImage(img, 0, 0, canvas.width, canvas.height);
    callback(canvas.toDataURL('image/jpeg', quality));
  };
  img.src = dataUrl;
}

function renderPhotoPreviews() {
  document.getElementById('photoPreviews').innerHTML = pendingPhotos.map((src, i) => `
    <div class="preview-wrap">
      <img class="preview-img" src="${src}" alt="preview" />
      <button class="remove-photo" onclick="removePhoto(${i})">‚úï</button>
    </div>`).join('');
}

function removePhoto(i) {
  pendingPhotos.splice(i, 1);
  renderPhotoPreviews();
}

function openLightbox(src) {
  document.getElementById('lightboxImg').src = src;
  document.getElementById('lightbox').classList.add('open');
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
}

// ‚îÄ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function saveEntry() {
  const name = document.getElementById('f_name').value.trim();
  const date = document.getElementById('f_date').value;
  if (!name || !date) { alert('Please fill in the restaurant name and date.'); return; }

  const tags = [...document.querySelectorAll('.tag-pick.selected')].map(t => t.textContent).join(', ');
  const row = {
    name, date,
    cuisine:          document.getElementById('f_cuisine').value,
    location:         document.getElementById('f_location').value.trim(),
    companions:       document.getElementById('f_companions').value.trim() || 'Solo',
    tags,
    score_cuisine:    document.getElementById('s_cuisine').value,
    score_atmosphere: document.getElementById('s_atmosphere').value,
    score_service:    document.getElementById('s_service').value,
    score_value:      document.getElementById('s_value').value,
    score_noise:      document.getElementById('s_noise').value,
    notes:            document.getElementById('f_notes').value.trim(),
  };

  const btn = document.getElementById('submitBtn');
  const status = document.getElementById('saveStatus');
  btn.disabled = true; btn.textContent = 'Saving‚Ä¶'; status.textContent = '';

  if (!API_URL) {
    if (pendingPhotos.length > 0) savePhotos(row, pendingPhotos);
    setTimeout(() => { btn.textContent = '‚úì Saved!'; setTimeout(() => showView('listView'), 1200); }, 600);
    return;
  }

  try {
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify({ data: [row] })
    });
    if (!res.ok) throw new Error();
    // Save photos locally keyed to this entry
    if (pendingPhotos.length > 0) savePhotos(row, pendingPhotos);
    btn.textContent = '‚úì Saved!';
    status.textContent = 'Entry added to your Google Sheet.';
    setTimeout(() => showView('listView'), 1200);
  } catch {
    btn.disabled = false; btn.textContent = 'Save to Journal ‚úì';
    status.textContent = '‚ö†Ô∏è Could not save. Check your connection.';
  }
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcOverall(e) {
  const vals = ['score_cuisine','score_atmosphere','score_service','score_value','score_noise']
    .map(k => parseFloat(e[k])).filter(v => !isNaN(v));
  return vals.length ? (vals.reduce((a,b) => a+b,0) / vals.length).toFixed(1) : '‚Äî';
}
function verdict(score) {
  if (score === '‚Äî') return '';
  if (score >= 9)   return 'Exceptional ‚Äî absolutely worth returning';
  if (score >= 8)   return 'Excellent ‚Äî highly recommended';
  if (score >= 7)   return 'Great ‚Äî would go back';
  if (score >= 6)   return 'Good ‚Äî enjoyable with some caveats';
  return 'Mixed ‚Äî wouldn\'t rush back';
}
function getColor(val) {
  if (val >= 8) return 'fill-high';
  if (val >= 6) return 'fill-mid';
  return 'fill-low';
}
function updateSlider(el) { el.nextElementSibling.textContent = el.value; }
function toggleTag(el)    { el.classList.toggle('selected'); }

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const { name: savedName } = getProfile();
if (!savedName) {
  // First time ‚Äî show onboarding
  document.getElementById('onboardView').classList.add('active');
} else {
  showMainApp();
}
</script>
</body>
</html>
